# Effective Mobile API

Cервис, который будет получать по API ФИО, из открытых API обогащать
ответ наиболее вероятными возрастом, полом и национальностью и сохранять данные в
БД. По запросу выдавать информацию о найденных людях.

## Технологии

- **Go:** Язык программирования, на котором написано API.
- **Gin:** Веб-фреймворк для Go.
- **PostgreSQL:** Реляционная база данных для хранения информации о людях.
- **Redis:** In-memory база данных, используемая для кэширования.
- **Docker & Docker Compose:** Для контейнеризации сервисов (API, PostgreSQL, Redis).
- **Swagger:** Для документации API.
- **Goose:** Для управления миграциями базы данных.
- **Zap:** Для логирования.

## Структура Базы Данных (PostgreSQL)

API использует базу данных PostgreSQL для хранения данных. Основная таблица:

- **`people`**:

  - `id` (SERIAL PRIMARY KEY): Уникальный идентификатор.
  - `name` (VARCHAR(255) NOT NULL): Имя.
  - `surname` (VARCHAR(255) NOT NULL): Фамилия.
  - `patronymic` (VARCHAR(255) NULL): Отчество (может быть NULL).
  - `age` (INTEGER NULL): Возраст (может быть NULL).
  - `gender` (VARCHAR(50) NULL): Пол (может быть NULL).
  - `nationality` (VARCHAR(10) NULL): Национальность (может быть NULL).
  - `created_at` (TIMESTAMP): Время создания записи.
  - `updated_at` (TIMESTAMP): Время последнего обновления записи.

  _Индексы:_

  - `idx_people_name` по полю `name`.
  - `idx_people_surname` по полю `surname`.

## Запуск проекта

### Запуск с использованием Docker Compose (Рекомендуемый способ)

1. **Склонируйте репозиторий:**

   ```bash
   git clone https://github.com/nikita89756/testEffectiveMobile.git
   ```
2. **Создайте файл `.env`** на основе примера или с вашими настройками (если он еще не существует). Пример `.env` файла находится в корне проекта.
3. **Запустите сервисы:**

   - С помощью Make:
     ```bash
     make docker-compose-up
     ```
   - Эта команда соберет образ API, запустит контейнеры для API, PostgreSQL и Redis. База данных будет автоматически создана при первом запуске, и миграции применятся.
4. **Остановка сервисов:**

   - С помощью Make:
     ```bash
     make docker-compose-down
     ```

### Локальный запуск (без Docker)

1. **Установите зависимости:**
   ```bash
   go mod download
   ```
2. **Запустите PostgreSQL и Redis** (убедитесь, что они доступны по адресам, указанным в `.env` или переменных окружения).
3. **Примените миграции:**
   Убедитесь, что переменные окружения для подключения к БД установлены или используйте DSN строку.
   ```bash
   make migrate-up

   ```
4. **Сгенерируйте документацию Swagger (если нужно):**
   ```bash
   make swag
   ```
5. **Соберите и запустите приложение:**
   ```bash
   make run

   ```

## API Эндпоинты

API предоставляет следующие эндпоинты:

- **`GET /persons`**: Получение списка людей с возможностью фильтрации и пагинации.
- **`POST /persons`**: Добавление нового человека. Данные (имя, фамилия, отчество) передаются в теле запроса. API обогащает данные, предполагая возраст, пол и национальность на основе имени.
- **`PUT /persons/{id}`**: Обновление данных существующего человека по ID.
- **`DELETE /persons/{id}`**: Удаление человека по ID.
- **`GET /persons/{id}`**: Получение данных конкретного человека по ID.

Подробную документацию API можно найти по адресу `/swagger/index.html` после запуска приложения (например, `http://localhost:8080/swagger/index.html`).

## Кэширование

Redis используется для кэширования ответов на запросы `GET /persons/{id}` для ускорения доступа к часто запрашиваемым данным и уменьшение нагрузки на внешний API.

## Запуск тестов

```bash
make tests
```
